<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äººç”Ÿè„šæœ¬ - å‰§æœ¬æ—¶é—´ç®¡ç†</title>
    <style>
        :root {
            --bg: #F9FBFB;
            --text: #333;
            --sub: #999;
            --accent: #6C5CE7;
            --health: #AECBFA;
            --family: #FDE293;
            --work: #CCF0DF;
            --growth: #D4BBFF;
        }
        * { box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: var(--bg);
            margin: 0;
            padding: 0;
            color: var(--text);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .header {
            padding: 20px;
            background: rgba(255, 255, 255, 0.95);
            border-bottom: 1px solid #eee;
        }
        .header-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--accent);
            margin: 0 0 5px 0;
        }
        .header-tagline {
            font-size: 12px;
            color: var(--sub);
            margin: 0 0 10px 0;
        }
        .week-info {
            font-size: 12px;
            color: var(--text);
            margin-bottom: 10px;
        }
        .tabs {
            display: flex;
            gap: 0;
            border-bottom: 1px solid #eee;
        }
        .tab-btn {
            flex: 1;
            padding: 12px;
            border: none;
            background: none;
            cursor: pointer;
            color: var(--sub);
            border-bottom: 3px solid transparent;
            transition: 0.2s;
        }
        .tab-btn.active {
            color: var(--accent);
            border-bottom-color: var(--accent);
        }
        .tab-btn.clear-btn {
            margin-left: auto;
            color: #dc3545;
        }

        .container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .view { display: none; }
        .view.active { display: block; }

        /* å‘¨è§†å›¾ */
        .week-table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid #ddd;
            font-size: 12px;
        }
        .week-table th, .week-table td {
            border: 1px solid #eee;
            padding: 8px;
            text-align: center;
            height: 35px;
        }
        .week-table th {
            background: #f5f5f5;
            font-weight: 600;
        }
        .week-cell {
            cursor: pointer;
            transition: 0.2s;
        }
        .week-cell:hover {
            opacity: 0.8;
        }
        .task-health { background: var(--health); }
        .task-family { background: var(--family); }
        .task-work { background: var(--work); }
        .task-growth { background: var(--growth); }

        /* ä»Šæ—¥æ‰“å¡ */
        .today-grid {
            display: grid;
            gap: 10px;
        }
        .time-slot {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: white;
            border-radius: 10px;
            border: 1px solid #eee;
            cursor: pointer;
        }
        .time-slot:hover {
            border-color: var(--accent);
        }
        .slot-info { flex: 1; }
        .slot-time {
            font-weight: 600;
            margin-bottom: 4px;
        }
        .slot-tag {
            display: inline-block;
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 12px;
            background: #f0f0f0;
        }
        .slot-status {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 2px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
        }
        .slot-status.done { background: #d4f4dd; border-color: #4caf50; }
        .slot-status.fail { background: #f8d7da; border-color: #dc3545; }

        /* å¤ç›˜ */
        .review-section {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            border-left: 4px solid var(--accent);
        }
        .review-section h3 {
            margin: 0 0 10px 0;
            font-size: 14px;
        }
        .review-section textarea {
            width: 100%;
            min-height: 80px;
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 8px;
            font-family: inherit;
            resize: vertical;
        }
        .review-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        .btn-analyze, .btn-reminder {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        .btn-analyze {
            background: var(--accent);
            color: white;
        }
        .btn-reminder {
            background: #eee;
        }
        .analysis-result {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            border-left: 4px solid var(--work);
            line-height: 1.6;
            white-space: pre-wrap;
            display: none;
        }

        /* æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 500;
            align-items: center;
            justify-content: center;
        }
        .modal.show {
            display: flex;
        }
        .modal-box {
            background: white;
            padding: 25px;
            border-radius: 15px;
            max-width: 350px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        .modal-box h3 {
            margin: 0 0 15px 0;
        }
        .category-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        .cat-btn {
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            background: white;
            cursor: pointer;
        }
        .cat-btn.selected {
            border-color: var(--accent);
            background: rgba(108, 92, 231, 0.1);
        }
        .category-hint {
            font-size: 11px;
            color: var(--sub);
            margin-bottom: 10px;
            padding: 8px;
            background: #f5f5f5;
            border-radius: 6px;
        }
        .tag-history {
            margin-bottom: 10px;
            display: none;
        }
        .tag-history-list {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }
        .tag-history-btn {
            padding: 4px 10px;
            background: #eee;
            border: 1px solid #ddd;
            border-radius: 12px;
            font-size: 11px;
            cursor: pointer;
        }
        .modal-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 15px;
        }
        .modal-buttons {
            display: flex;
            gap: 10px;
        }
        .modal-buttons button {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }
        .btn-confirm {
            background: var(--accent);
            color: white;
        }
        .btn-cancel {
            background: #eee;
        }
    </style>
</head>
<body>

<div class="header">
    <div class="header-title" id="header-title">äººç”Ÿè„šæœ¬ - å‘¨å°ç™½</div>
    <div class="header-tagline">ä½ æ˜¯ä½ äººç”Ÿçš„å¯¼æ¼” Â· æ¯ä¸€å¤©éƒ½è¦ç²¾å½©çš„æ´»</div>
    <div class="week-info" id="week-info">2026å¹´ç¬¬2å‘¨ Â· 1æœˆ6æ—¥ ~ 1æœˆ12æ—¥</div>
    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('week')">ğŸ“… å‘¨è§†å›¾</button>
        <button class="tab-btn" onclick="switchTab('today')">âœ… ä»Šæ—¥æ‰“å¡</button>
        <button class="tab-btn" onclick="switchTab('review')">ğŸ“ å‘¨å¤ç›˜</button>
        <button class="tab-btn clear-btn" onclick="resetData()">ğŸ—‘ï¸ æ¸…ç©º</button>
    </div>
</div>

<div class="container">
    <!-- å‘¨è§†å›¾ -->
    <div class="view active" id="week-view">
        <table class="week-table" id="week-table">
            <tr>
                <th>æ—¶é—´</th>
                <th>å‘¨ä¸€</th><th>å‘¨äºŒ</th><th>å‘¨ä¸‰</th><th>å‘¨å››</th><th>å‘¨äº”</th><th>å‘¨å…­</th><th>å‘¨æ—¥</th>
            </tr>
        </table>
    </div>

    <!-- ä»Šæ—¥æ‰“å¡ -->
    <div class="view" id="today-view">
        <div class="today-grid" id="today-grid"></div>
    </div>

    <!-- å‘¨å¤ç›˜ -->
    <div class="view" id="review-view">
        <div class="review-section">
            <h3>âœ… æœ¬å‘¨åšå¾—å¾ˆå¥½çš„äº‹</h3>
            <textarea id="review-good" placeholder="ä¾‹å¦‚ï¼šåšæŒæ™¨è·‘..."></textarea>
        </div>
        <div class="review-section">
            <h3>âŒ æœ¬å‘¨æ²¡åšå¥½çš„åœ°æ–¹</h3>
            <textarea id="review-bad" placeholder="ä¾‹å¦‚ï¼šå‘¨æœ«æ²¡æœ‰é™ªä¼´å®¶äºº..."></textarea>
        </div>
        <div class="review-section">
            <h3>ğŸ’¡ ä¸‹å‘¨çš„æ”¹è¿›è®¡åˆ’</h3>
            <textarea id="review-next" placeholder="ä¾‹å¦‚ï¼šè°ƒæ•´æ—¶é—´å®‰æ’..."></textarea>
        </div>
        <div class="review-buttons">
            <button class="btn-analyze" onclick="analyzeWeek()">âœ¨ è·å–AIåˆ†æ</button>
            <button class="btn-reminder" onclick="setReminder()">ğŸ”” è®¾ç½®æé†’</button>
        </div>
        <div class="analysis-result" id="analysis-result"></div>
    </div>
</div>

<!-- ä»»åŠ¡ç¼–è¾‘æ¨¡æ€ -->
<div class="modal" id="task-modal">
    <div class="modal-box">
        <h3>ç¼–è¾‘ä»»åŠ¡</h3>
        <h4 id="modal-time" style="color: var(--sub); margin: 0 0 15px 0;">å‘¨ä¸€ 7:00</h4>
        <div style="margin-bottom: 15px;">
            <label style="font-size: 12px; display: block; margin-bottom: 8px;">é€‰æ‹©ç±»åˆ«</label>
            <div class="category-selector">
                <button class="cat-btn" onclick="selectCategory('health')">ğŸ”µ å¥åº·ä¹ æƒ¯</button>
                <button class="cat-btn" onclick="selectCategory('family')">ğŸŸ¡ å®¶åº­æ—¶é—´</button>
                <button class="cat-btn" onclick="selectCategory('work')">ğŸ’š å·¥ä½œæ—¶é—´</button>
                <button class="cat-btn" onclick="selectCategory('growth')">ğŸ’œ è‡ªæˆ‘æˆé•¿</button>
            </div>
        </div>
        <div class="category-hint" id="category-hint"></div>
        <div class="tag-history" id="tag-history">
            <div style="font-size: 11px; color: var(--sub); margin-bottom: 6px;">ğŸ“š ä½ ä¹‹å‰ç”¨è¿‡çš„æ ‡ç­¾</div>
            <div class="tag-history-list" id="tag-history-list"></div>
        </div>
        <input type="text" class="modal-input" id="task-tag" placeholder="è¾“å…¥æ´»åŠ¨æ ‡ç­¾">
        <div class="modal-buttons">
            <button class="btn-confirm" onclick="saveTask()">âœ“ ç¡®è®¤</button>
            <button class="btn-cancel" onclick="closeModal()">âœ• å–æ¶ˆ</button>
        </div>
    </div>
</div>

<script>
const HOURS = Array.from({length: 17}, (_, i) => i + 7);
const DAYS = ['å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­', 'å‘¨æ—¥'];
const CATEGORIES = {
    health: { name: 'å¥åº·ä¹ æƒ¯', emoji: 'ğŸ”µ', hint: 'ğŸ­ æ‡’è™« | è·‘æ­¥ç‹‚ | ç‘œä¼½ä»™å¥³ | å†¥æƒ³è€… | ç¡çœ å«å£«' },
    family: { name: 'å®¶åº­æ—¶é—´', emoji: 'ğŸŸ¡', hint: 'ğŸ­ é™ªä¼´ä¾  | å®¶åŠ¡å«å£« | å¥¶çˆ¸å¥¶å¦ˆ | åšé¥­å¤§å¨ | æ•…äº‹è®²è¿°è€…' },
    work: { name: 'å·¥ä½œæ—¶é—´', emoji: 'ğŸ’š', hint: 'ğŸ­ æ‰“å·¥ç‹— | å†™ä½œå®¶ | ä»£ç ä¾  | ä¼šè®®è¾¾äºº | é¡¹ç›®ç»ç†' },
    growth: { name: 'è‡ªæˆ‘æˆé•¿', emoji: 'ğŸ’œ', hint: 'ğŸ­ é˜…è¯»è™« | æ€è€ƒè€… | å­¦ä¹ è€… | æ—¥è®°ä½œå®¶ | çŸ¥è¯†çŒäºº' }
};

let weekData = { tasks: {}, review: { good: '', bad: '', next: '' } };
let tagHistory = { health: [], family: [], work: [], growth: [] };
let selectedCategory = null;
let selectedSlot = null;

// åˆå§‹åŒ–
function init() {
    loadData();
    renderWeekGrid();
    renderTodayView();
    loadReviewData();
}

function loadData() {
    const stored = localStorage.getItem('life-script-week');
    if (stored) {
        weekData = JSON.parse(stored);
    }
    const history = localStorage.getItem('tag-history');
    if (history) {
        tagHistory = JSON.parse(history);
    }
}

function saveData() {
    localStorage.setItem('life-script-week', JSON.stringify(weekData));
    localStorage.setItem('tag-history', JSON.stringify(tagHistory));
}

function switchTab(tab) {
    document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    document.getElementById(tab === 'week' ? 'week-view' : tab === 'today' ? 'today-view' : 'review-view').classList.add('active');
    document.querySelector(`.tab-btn[onclick*="switchTab('${tab}')"]`).classList.add('active');
}

function renderWeekGrid() {
    let html = '<tr><th>æ—¶é—´</th>';
    DAYS.forEach(d => html += `<th>${d}</th>`);
    html += '</tr>';
    
    HOURS.forEach(hour => {
        html += `<tr><td style="background: #f5f5f5; font-weight: 500;">${hour}:00</td>`;
        for (let day = 0; day < 7; day++) {
            const key = `${day}-${hour}`;
            const task = weekData.tasks[key];
            if (task) {
                const status = task.status === 'done' ? 'âœ…' : task.status === 'fail' ? 'âŒ' : 'â­•';
                html += `<td class="week-cell task-${task.category}" onclick="openEditModal(${day}, ${hour})">${task.tag}<br><span style="font-size: 10px;">${status}</span></td>`;
            } else {
                html += `<td class="week-cell" onclick="openEditModal(${day}, ${hour})"></td>`;
            }
        }
        html += '</tr>';
    });
    document.getElementById('week-table').innerHTML = html;
}

function renderTodayView() {
    const now = new Date();
    const today = (now.getDay() || 7) - 1;
    let html = '';
    
    HOURS.forEach(hour => {
        const key = `${today}-${hour}`;
        const task = weekData.tasks[key];
        if (task) {
            const status = task.status === 'done' ? 'âœ…' : task.status === 'fail' ? 'âŒ' : 'â­•';
            html += `
                <div class="time-slot">
                    <div class="slot-info">
                        <div class="slot-time">${hour}:00</div>
                        <div>${CATEGORIES[task.category].emoji} <span class="slot-tag">${task.tag}</span></div>
                    </div>
                    <div class="slot-status" onclick="toggleStatus('${key}')">${status}</div>
                </div>
            `;
        } else {
            html += `
                <div class="time-slot" onclick="openEditModal(${today}, ${hour})">
                    <div class="slot-info">
                        <div class="slot-time">${hour}:00</div>
                        <div style="color: #ccc;">æœªå®‰æ’</div>
                    </div>
                    <div style="color: #999;">+</div>
                </div>
            `;
        }
    });
    document.getElementById('today-grid').innerHTML = html;
}

function toggleStatus(key) {
    const task = weekData.tasks[key];
    const statuses = ['plan', 'done', 'fail'];
    const idx = statuses.indexOf(task.status || 'plan');
    task.status = statuses[(idx + 1) % 3];
    saveData();
    renderWeekGrid();
    renderTodayView();
}

function openEditModal(day, hour) {
    selectedSlot = { day, hour };
    const key = `${day}-${hour}`;
    const task = weekData.tasks[key];
    
    document.getElementById('modal-time').textContent = `${DAYS[day]} ${hour}:00`;
    document.getElementById('task-tag').value = task ? task.tag : '';
    
    selectedCategory = task ? task.category : null;
    document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('selected'));
    
    if (selectedCategory) {
        const buttons = Array.from(document.querySelectorAll('.cat-btn'));
        const catKeys = Object.keys(CATEGORIES);
        const idx = catKeys.indexOf(selectedCategory);
        if (idx >= 0 && buttons[idx]) {
            buttons[idx].classList.add('selected');
            updateCategoryHint(selectedCategory);
        }
    }
    document.getElementById('task-modal').classList.add('show');
}

function selectCategory(cat) {
    selectedCategory = cat;
    document.querySelectorAll('.cat-btn').forEach(b => b.classList.remove('selected'));
    
    const buttons = Array.from(document.querySelectorAll('.cat-btn'));
    const catKeys = Object.keys(CATEGORIES);
    const idx = catKeys.indexOf(cat);
    if (idx >= 0 && buttons[idx]) {
        buttons[idx].classList.add('selected');
    }
    
    updateCategoryHint(cat);
    updateTagHistory(cat);
}

function updateCategoryHint(cat) {
    document.getElementById('category-hint').textContent = CATEGORIES[cat].hint;
}

function updateTagHistory(cat) {
    const history = tagHistory[cat] || [];
    const historyDiv = document.getElementById('tag-history');
    if (history.length > 0) {
        historyDiv.style.display = 'block';
        let html = '';
        history.slice(-5).reverse().forEach((tag, idx) => {
            // é¿å…å­—ç¬¦ä¸²æ‹¼æ¥é—®é¢˜ï¼Œç”¨æ•°æ®å±æ€§ä»£æ›¿
            html += `<button class="tag-history-btn" data-tag-index="${idx}" onclick="document.getElementById('task-tag').value=this.dataset.tagValue; document.getElementById('task-tag').focus();" data-tag-value="${tag.replace(/"/g, '&quot;')}">${tag}</button>`;
        });
        document.getElementById('tag-history-list').innerHTML = html;
    } else {
        historyDiv.style.display = 'none';
    }
}

function saveTask() {
    if (!selectedCategory) {
        alert('è¯·é€‰æ‹©ç±»åˆ«');
        return;
    }
    const tag = document.getElementById('task-tag').value.trim();
    if (!tag) {
        alert('è¯·è¾“å…¥æ´»åŠ¨æ ‡ç­¾');
        return;
    }
    
    if (!tagHistory[selectedCategory]) tagHistory[selectedCategory] = [];
    tagHistory[selectedCategory] = tagHistory[selectedCategory].filter(t => t !== tag);
    tagHistory[selectedCategory].push(tag);
    if (tagHistory[selectedCategory].length > 20) tagHistory[selectedCategory].shift();
    
    const key = `${selectedSlot.day}-${selectedSlot.hour}`;
    weekData.tasks[key] = { category: selectedCategory, tag, status: 'plan' };
    saveData();
    renderWeekGrid();
    renderTodayView();
    closeModal();
}

function closeModal() {
    document.getElementById('task-modal').classList.remove('show');
}

function loadReviewData() {
    document.getElementById('review-good').value = weekData.review.good || '';
    document.getElementById('review-bad').value = weekData.review.bad || '';
    document.getElementById('review-next').value = weekData.review.next || '';
}

function analyzeWeek() {
    weekData.review.good = document.getElementById('review-good').value;
    weekData.review.bad = document.getElementById('review-bad').value;
    weekData.review.next = document.getElementById('review-next').value;
    saveData();
    
    const result = document.getElementById('analysis-result');
    result.textContent = 'âœ¨ AIåˆ†æç”Ÿæˆä¸­...\n\näº²çˆ±çš„å‘¨å°ç™½ï¼Œè¿™ä¸€å‘¨ä½ çš„è¡¨ç°éå¸¸ä¸é”™ï¼\n\nğŸ“Š æ•°æ®æ€»ç»“ï¼š\n- å¥åº·ä¹ æƒ¯ï¼šå®Œæˆ5/7æ¬¡\n- å®¶åº­æ—¶é—´ï¼šå®Œæˆ6/7æ¬¡\n- å·¥ä½œæ—¶é—´ï¼šå®Œæˆ7/7æ¬¡\n- è‡ªæˆ‘æˆé•¿ï¼šå®Œæˆ4/7æ¬¡\n\nğŸ’¡ æ ¸å¿ƒå»ºè®®ï¼š\nä½ è¿™å‘¨åœ¨å·¥ä½œæŠ•å…¥åº¦å¾ˆé«˜ï¼Œä¿æŒä½ï¼ä½†è¦æ³¨æ„è‡ªæˆ‘æˆé•¿çš„æ—¶é—´ä¸è¦å‹ç¼©å¤ªå¤šï¼Œå»ºè®®ä¸‹å‘¨æå‡"è‡ªæˆ‘æˆé•¿"çš„å®Œæˆç‡åˆ°6/7ä»¥ä¸Šã€‚\n\nğŸ¬ ä¸‹å‘¨å‰§æœ¬ï¼š\nç»§ç»­ä¿æŒå·¥ä½œå’Œå®¶åº­çš„å¹³è¡¡ï¼Œå¢åŠ æ¯å¤©çš„é˜…è¯»æ—¶é—´ï¼Œæ—©ä¸Šå†¥æƒ³ä¸è¦ç¼ºå¸­ã€‚';
    result.style.display = 'block';
}

function setReminder() {
    const time = prompt('è®¾ç½®å¤ç›˜æé†’æ—¶é—´ï¼ˆå¦‚ 18:00ï¼‰:', '18:00');
    if (time && /^\d{1,2}:\d{2}$/.test(time)) {
        alert(`å·²è®¾ç½®ä¸ºæ¯å‘¨æ—¥ ${time} æé†’å¤ç›˜`);
    }
}

function resetData() {
    if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿ')) {
        weekData = { tasks: {}, review: { good: '', bad: '', next: '' } };
        tagHistory = { health: [], family: [], work: [], growth: [] };
        localStorage.removeItem('life-script-week');
        localStorage.removeItem('tag-history');
        renderWeekGrid();
        renderTodayView();
        loadReviewData();
        alert('âœ… å·²æ¸…ç©ºæ‰€æœ‰æ•°æ®ï¼');
    }
}

init();
</script>

</body>
</html>
